<section class="complaints-list">
  <h2>Your Complaints</h2>

  <!-- If no complaints -->
  <div *ngIf="openComplaints.length === 0" class="no-complaints">
    You have not raised any complaints yet.
  </div>

  <!-- Complaints table -->
  <table *ngIf="openComplaints.length > 0" class="complaints-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Description</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let complaint of openComplaints">
        <td>{{ complaint.id }}</td>

        <!-- Title -->
        <td *ngIf="!complaint.editMode">{{ complaint.title }}</td>
        <td *ngIf="complaint.editMode">
          <input type="text" [(ngModel)]="complaint.editTitle" />
        </td>

        <!-- Description -->
        <td *ngIf="!complaint.editMode">{{ complaint.description }}</td>
        <td *ngIf="complaint.editMode">
          <textarea [(ngModel)]="complaint.editDescription"></textarea>
        </td>

        <!-- Status -->
        <td
          [ngClass]="{
            'status-open': complaint.status === 'open',
            'status-inprogress': complaint.status === 'in_progress',
            'status-resolved': complaint.status === 'resolved'
          }"
        >
          {{ complaint.status }}
        </td>

        <!-- Actions -->
        <td class="actions">
          <!-- OPEN STATUS ACTIONS -->
          <ng-container *ngIf="complaint.status === 'open'; else resolvedActions">
            <button *ngIf="!complaint.editMode" class="table-btn edit-btn" (click)="enableEdit(complaint)">Edit</button>
            <button *ngIf="complaint.editMode" class="table-btn save-btn" (click)="saveEdit(complaint)">Save</button>
            <button *ngIf="complaint.editMode" class="table-btn cancel-btn" (click)="cancelEdit(complaint)">Cancel</button>
            <button class="table-btn delete-btn" (click)="deleteComplaint(complaint.id!, complaint.status)">Delete</button>
          </ng-container>

          <!-- RESOLVED / CLOSED ACTIONS -->
          <ng-template #resolvedActions>
            <button
              *ngIf="complaint.status === 'resolved'"
              class="table-btn close-btn"
              (click)="openCloseModal(complaint)"
            >
              Close Complaint
            </button>

            <span *ngIf="complaint.status === 'closed'" class="closed-text">Closed</span>
          </ng-template>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Close Complaint Modal -->
  <div class="modal-backdrop" *ngIf="showCloseModal">
    <div class="modal">
      <h3>Close Complaint</h3>
      <p>Do you want to close complaint #{{ modalComplaint?.id }} titled "<em>{{ modalComplaint?.title }}</em>"?</p>
      <div class="modal-actions">
        <button class="table-btn" (click)="confirmClose()">Yes, Close</button>
        <button class="table-btn" (click)="cancelClose()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- ⭐ Feedback Modal (opens after closing a complaint) -->
  <div class="modal-backdrop" *ngIf="showFeedbackModal">
    <div class="modal feedback-modal">
      <h3>Rate Your Experience</h3>
      <p>
        Please provide feedback for the staff who handled complaint 
        <strong>#{{ feedbackComplaint?.id }}</strong>.
      </p>

      <!-- ⭐ Star Rating -->
      <div class="stars">
        <span 
          *ngFor="let star of [1,2,3,4,5]" 
          (click)="feedbackRating = star"
          [class.selected]="star <= feedbackRating"
        >
          ★
        </span>
      </div>

      <!-- Optional feedback description -->
      <textarea 
        name="feedbackText"
        placeholder="Write feedback (optional)" 
        [(ngModel)]="feedbackText"
      ></textarea>

      <div class="modal-actions">
        <button class="table-btn save-btn" (click)="submitFeedback()">Submit</button>
        <button class="table-btn cancel-btn" (click)="cancelFeedback()">Cancel</button>
      </div>
    </div>
  </div>
<!-- Success message -->
<div *ngIf="successMessage" class="alert-message success"  (click)="clearMessages() ">
  {{ successMessage }}
</div>

<!-- Error message -->
<div *ngIf="errorMessage" class="alert-message error"  (click)="clearMessages() ">
  {{ errorMessage }}
</div>




</section>
